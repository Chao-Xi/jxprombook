
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's Prometheus 技术实战教程">
      
      
        <meta name="author" content="Jacob Xi">
      
      
      
        <link rel="prev" href="../../chap6/33Prometheus_Monitor_memcached/">
      
      
        <link rel="next" href="../../chap8/1Promql_basic1/">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter - Jacob Prometheus Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#by-prometheus-adapter-and-flask-exporter" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob Prometheus Book" class="md-header__button md-logo" aria-label="Jacob Prometheus Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob Prometheus Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxprombook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxprombook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob Prometheus Book" class="md-nav__button md-logo" aria-label="Jacob Prometheus Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Jacob Prometheus Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxprombook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxprombook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    监控解决方案
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            监控解决方案
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap0/1monitor_tools10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 监控解决方案：10个 Kubernetes 监控工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/11Prom_intro_2023-CN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 云原生系统监控
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus技术介绍,K8S Metrics介绍&查看
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Prometheus技术介绍,K8S Metrics介绍&查看
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/57prometheus_best_practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第零节 Promethues 应用监控的一些实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/1prometheus2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Prometheus 系统介绍 2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/18Adv_Prometheus_index_classfication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 深入Prometheus设计-指标定义与分类(PromQL)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/k8s_adv39_kube_state_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 kube-state-metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/17Adv_K8S_Metrics_Server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 Metrics Server 安装
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/20Install_metrics_server_SAP_CC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 Install Kubernetes Metrics Server on SAP Converged Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/38k8s_hpa_metricsserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 Kubernetes HPA 使用详解(Metrics Server/CPU/Mem/adapater)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/55prometheus_go_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 为Go应用添加Prometheus监控指标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/37kubectl_top/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 从kubectl top看K8S监控原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/9kube-state-metrics_crd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节 通过 kube-state-metrics 添加 CRD 状态指标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/10kube-state-metrics-cluster-opt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十节 kube-state-metrics 在大规模集群下的优化(2023)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus on Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Prometheus on Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/19centos7_Prometheus_Alertmanager_Grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Centos7 Prometheus安装部署+监控+绘图+告警
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/59node_exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 使用Node Exporter监控Linux主机&常用监控指标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/36Prometheus_Mysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 基于Prometheus构建MySQL可视化监控平台
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/4mysql_exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 官方 mysqld_exporter支持抓取多MySQL实例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/5prom_grafana_chatops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 使用 Grafana、Prometheus 和 Slack 构建一个简单的 ChatOps 机器人
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    手动部署Kubernetes Prometheus
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            手动部署Kubernetes Prometheus
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/1prometheus_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Kubernetes使用Prometheus搭建监控平台(2018)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/2prometheus_AlertManager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Prometheus报警 && AlertManager实战（2018）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/3changes_on_Grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 Grafana 显示参数设置(2018)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/4Adv_Prometheus_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 在 Kubernetes 中手动部署 Prometheus (adv)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/5Adv_Prometheus_monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 应用监控（Metrics/Exporter的配置）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/6Adv_K8S_Nodes_monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 监控K8S集群节点&Node-exporter DaemonSet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/7Adv_K8S_Resource_monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 监控常用资源对象（容器/apiserver/Service监控/kube-state-metric）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/8Adv_K8S_Grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 Grafana 在 Kubernetes 中的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/10Adv_k8s_AlertManger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节 报警神器 AlertManager 的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/16Adv_Prometheus_Del_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十节 Prometheus 删除数据指标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/50PrometheusAlert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十一节 Prometheus中使用PrometheusAlert进行聚合报警
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/12gpu_monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十二节 监控Kubernetes集群的GPU资源
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/29AlertManager_SendAlerts_when/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十三节 AlertManager何时报警
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/41Prometheus_Monitor_OutCluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十四节 Prometheus监控外部Kubernetes集群
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    玩转Prometheus Operator
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            玩转Prometheus Operator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/11Adv_Prometheus_Operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Prometheus Operator 初体验
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/13Adv_Prometheus_Operator_etcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 使用 Prometheus Operator 监控 etcd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/14Adv_Prometheus_Operator_alarm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 Prometheus Operator 自定义报警
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/22Customize_Alert_Email/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 Add Custom Alert and Send Alert Email with Alertmanager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/24Kubernetes_Prometheus_blackbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 Prometheus 黑盒监控
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/32Prometheus_troubleshoot_Servicemonitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 Troubleshooting ServiceMonitor changes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/43Prometheus_operator_ssl_exporter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 使用ssl_exporter监控K8S集群证书
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/44Prometheus_KubeNurse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 Operator2021-使用KubeNurse进行集群网络监控
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/45Prom-operator_2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节 Prometheus Operator安装配置(2021)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/46Prometheus_traefik/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十节 Traefik之使用Prometheus Operator进行监控报警2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/47Prometheus_opt_AlertmanagerConfig/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十一节 Operator使用AlertmanagerConfig进行报警配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/49Prometheus_SLI_SLO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十二节 通过Prometheus来做SLI/SLO监控展示
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/51missing-container-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十三节 Prometheus使用missing-container-metrics监控Pod oomkill
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/chap4_blackbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十四节 如何在Prometheus中进行黑盒监控(ICMP/DNS/TCP/HTTP/gRPC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/chap4_Operator_probe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第十五节 Prometheus Operator中探针的使用（Blackbox Exporter）
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus服务发现
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Prometheus服务发现
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/53Prometheus_auto_discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Prometheus服务的自动发现使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/52Prometheus_Relabeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Prometheus Relabeling重新标记的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/54prometheus_go_metrics_guideline/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 如何使用Prometheus仪表化应用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Jam prometheus Monitor
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Jam prometheus Monitor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/25Alertmanager_AWS_SES/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap1 Alertmanager alerts with Amazon SES SMTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/26Prometheus_Monitor_Argocd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap2 Prometheus Operator Monitor on ArgoCD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/27Prometheus_Monitor_elasticsearch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap3 Prometheus Operator Monitor on ElasticSearch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/31Prometheus_Monitor_rabbitmq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap4 Prometheus Operator Monitor on Rabbitmq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/33Prometheus_Monitor_memcached/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chap5 Prometheus Operator Monitor on Memcached
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus-Adapter
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Prometheus-Adapter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1 环境准备
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-clone" class="md-nav__link">
    <span class="md-ellipsis">
      2 Clone 项目
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-prometheus-operator" class="md-nav__link">
    <span class="md-ellipsis">
      2 安装 Prometheus Operator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 安装 Prometheus Operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psp-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      **可能出现的问题 psp Configuration **
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3 扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    <span class="md-ellipsis">
      3-1 部署应用到集群中
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1-discover" class="md-nav__link">
    <span class="md-ellipsis">
      4-1 discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-2-association" class="md-nav__link">
    <span class="md-ellipsis">
      4-2 Association
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-3-naming" class="md-nav__link">
    <span class="md-ellipsis">
      4-3 naming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-4-querying" class="md-nav__link">
    <span class="md-ellipsis">
      4-4 Querying
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-hpa" class="md-nav__link">
    <span class="md-ellipsis">
      5 部署 HPA 对象
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      6 在 Grafana 中显示缩放数据
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PromQL学习
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            PromQL学习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/1Promql_basic1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 初识 PromQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/2Promql_basic2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 PromQL 操作符 & 内置函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/3Promql_basic3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 PromQL 内置函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/4Promql_basic4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 PromQL简单示例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/5Promql_basic5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 在 HTTP API中使用 PromQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/6Promql_adv1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Prometheus记录规则的使用(Recording Rule)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/56prometheus_promql_rate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 PromQL查询之rate函数的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/60prometheus_job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 解决Prometheus监控Kubernetes Job误报的坑
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap8/9promql_6errors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 使用 Prometheus PromQL时需要避免这6个错误
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Awesome alerts rules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Awesome alerts rules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/1basic_resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Basic resource monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/2database_broker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Databases and brokers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/3proxy_lb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Reverse proxies and load balancers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/4runtimes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Runtimes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/5Orchestrators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Orchestrators
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/6network_sec_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 Network, security and storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/7other/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Others
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/8Alerting_sleep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Alert Sleep Peacefully
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据可视化&Grafana Plugin
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            数据可视化&Grafana Plugin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/58grafana_init/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 使用 Grafana 构建你的第一个仪表盘
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/28Grafana_plugin_DevOpsProdigy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 优秀的Grafana K8S 插件-DevOpsProdigy KubeGraf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/30Create_Grafana_dashboards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 用 Kubernetes darks资源对象创建Grafana Dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/48grafana_Trickster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Grafana 图表加速神器-Trickster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/5Grafana_Loki/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 使用读写分离模式扩展 Grafana Loki
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/6Prometheus_grafaa_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 使用 Prometheus 和 Grafana 实现服务器运行状态监控（基于 Docker）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/7loki_promtail_grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 Docker上部署LPG（loki+promtail+grafana）踩坑复盘
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus(OpenTelemetry)架构设计与工具平台
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Prometheus(OpenTelemetry)架构设计与工具平台
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/1deepflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 DeepFlow AutoTagging之Prometheus标签标准化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/2Prometheus_opentele/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Prometheus与OpenTelemetry该选哪个？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/3Prometheus_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Prometheus的四种指标类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/4OpenTelemetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 透彻理解OpenTelemetry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/4OpenTelemetry_tracing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 使用OpenTelemetry Tracing最大化Kubernetes效率
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Thanos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Thanos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/39Thanos_tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 大规模场景下Prometheus的优化手段&Thanos架构详解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/34Thanos_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 使用Thanos实现Prometheus的高可用介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/35Thanos_install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 Prometheus高可用Thanos学习-sidercar和query&Thanos部署
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/61thanos_sidecar_receiver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节（2022）如何选择Thanos的Sidecar和Receiver两种模式？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/62thanos_query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节（2022）使用Thanos查询前端优化查询性能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/63prometheus_optimiztion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 (Thaos1-2022)大规模场景下Prometheus的优化手段
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/64thanos_detail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 (Thaos2-2022)Thanos架构详解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/65thanos_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第八节 (Thaos3-2022)Thanos部署与实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/66thanos_ruler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第九节（2022）Thanos Ruler组件的使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    VictoriaMetrics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            VictoriaMetrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/67vm_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 Prometheus远程存储VictoriaMetrics简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/68vm_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 Prometheus长期远程存储方案VictoriaMetrics入门实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/69vm_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 VictorialMetrics 集群模式的使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/70vm_vmagent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 使用vmagent代替Prometheus采集监控指标
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/71vm_operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第五节 使用Victoria Metrics Operator管理VM集群
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/72vm_vmalert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 使用 vmalert 代替 Prometheus 监控报警
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/73vm_pressure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第七节 对Prometheus兼容的时序数据库进行压力测试
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    APM 工具及功能介绍
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            APM 工具及功能介绍
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/1apm_prods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第一节 APM产品落地实战
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/2opentracing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第二节 APM + OpenTracing原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/3apm_tracing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第三节 怎么理解分布式链路追踪技术？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/4apm_prod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第四节 在生产环境中如何选择靠谱的APM系统？
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/6k8s_watching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第六节 聊聊可观测性之数据模型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OpenTelemetry 介绍
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            OpenTelemetry 介绍
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ot/0OpenTelemetrey_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0 OpenTelemetry保姆入门攻略可PPT-2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ot/1OpenTelemetry_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 云原生可观测 OpenTelemetry 基础知识
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ot/1OpenTelemetry_k8s_metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 使用 OpenTelemetry Collector 采集 Kubernetes 指标数据
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ot/5OpenTelemetry_log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 使用 OpenTelemetry Collector 收集 Kubernetes 日志数据
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/5apm_Sentry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Sentry+OpenTelemetry前后端全链路打通
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/2OpenTelemetry_MS.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 使用 OpenTelemetry Tracing 了解您的微服务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/3OpenTelemetry_K8S.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 使用 OpenTelemetry Tracing 最大化Kubernetes效率
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/4OpenTelemetry_datamon.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 聊聊可观测性之数据模型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/6OpenTelemetry_java.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 Java 应用通过 OpenTelemetry API 实现手动埋点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_ot/7OT_practice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 Opentelemetry 采样最佳实践(概率采样器/尾部采样器)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1 环境准备
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-clone" class="md-nav__link">
    <span class="md-ellipsis">
      2 Clone 项目
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-prometheus-operator" class="md-nav__link">
    <span class="md-ellipsis">
      2 安装 Prometheus Operator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 安装 Prometheus Operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psp-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      **可能出现的问题 psp Configuration **
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3 扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3 扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-1" class="md-nav__link">
    <span class="md-ellipsis">
      3-1 部署应用到集群中
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4 扩容
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4 扩容">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#4-1-discover" class="md-nav__link">
    <span class="md-ellipsis">
      4-1 discover
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-2-association" class="md-nav__link">
    <span class="md-ellipsis">
      4-2 Association
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-3-naming" class="md-nav__link">
    <span class="md-ellipsis">
      4-3 naming
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-4-querying" class="md-nav__link">
    <span class="md-ellipsis">
      4-4 Querying
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-hpa" class="md-nav__link">
    <span class="md-ellipsis">
      5 部署 HPA 对象
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      6 在 Grafana 中显示缩放数据
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="by-prometheus-adapter-and-flask-exporter"><strong>应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter</strong></h1>
<p><img alt="Alt Image Text" src="../../images/23_7.png" title="body image" /></p>
<h2 id="1"><strong>1 环境准备</strong></h2>
<ul>
<li><code>1.10.0+</code> 版本的 Kubernetes 集群</li>
<li>可以访问集群的节点上安装 <code>Helm</code> 和 <code>Kubectl</code> 工具</li>
<li>在集群中初始化了 <code>Helm</code></li>
</ul>
<h2 id="2-clone"><strong>2 Clone 项目</strong></h2>
<p>本文使用到的相关代码都统一放置到了 <code>GitHub</code> 上，<code>Clone</code> 代码到本地：</p>
<pre><code>$ git clone https://github.com/cnych/k8s-prometheus-custom-scaling.git
$ cd k8s-prometheus-custom-scaling
</code></pre>
<p>我们可以先来看一下将要扩容的应用。是使用 <code>Flask</code> 作为后端 <code>React</code> 作为前端的一个项目，另外还使用了 <a href="https://github.com/rycus86/prometheus_flask_exporter">Flask Promethues Exporter</a> 这个第三方库，核心的后端代码如下所示：</p>
<pre><code>from flask import Flask, render_template
from prometheus_flask_exporter.multiprocess import GunicornInternalPrometheusMetrics

application = Flask(__name__, static_folder=&quot;./public&quot;, template_folder=&quot;./templates&quot;)
metrics = GunicornInternalPrometheusMetrics(application)


@application.route(&quot;/&quot;)
def index():
    return render_template(&quot;index.html&quot;)


@application.route(&quot;/click-button&quot;, methods=[&quot;POST&quot;])
@metrics.counter(&quot;demo_app_button_clicks&quot;, &quot;Number of button presses by user&quot;)
def web_button():
    return {}
</code></pre>
<p>我们可以在本地先使用 <code>docker-compose</code> 来运行该应用：</p>
<pre><code>$ docker-compose up -d
</code></pre>
<p><strong>报错了</strong></p>
<pre><code>...
npm WARN npm npm does not support Node.js v10.15.2
npm WARN npm You should probably upgrade to a newer version of node as we
npm WARN npm can't make any promises that npm will work with this version.
npm WARN npm Supported releases of Node.js are the latest release of 4, 6, 7, 8, 9.
npm WARN npm You can find the latest version at https://nodejs.org/
...
</code></pre>
<p><strong>修改<code>Dockerfile</code>了</strong> </p>
<pre><code>FROM ubuntu:19.04

RUN apt-get update
RUN apt-get install -y python python-pip
RUN apt-get install -y npm nodejs

COPY . /app

RUN pip install -r /app/requirements.txt
RUN npm install npm@latest -g    # update npm tp the latest version
RUN npm install --prefix /app/demo_app/src --no-package-lock
RUN npm run-script build --prefix /app/demo_app/src

WORKDIR /app/demo_app
ENV prometheus_multiproc_dir /tmp
EXPOSE 8000
CMD [ &quot;gunicorn&quot;, &quot;-c&quot;, &quot;config.py&quot;, &quot;-w&quot;, &quot;4&quot;, &quot;-b&quot;, &quot;0.0.0.0:8000&quot;, &quot;server&quot;]
</code></pre>
<p>启动后可以在浏览器中打开 <code>localhost:8000</code> 来访问我们的应用：</p>
<p><img alt="Alt Image Text" src="../../images/23_1.png" title="body image" /></p>
<p>这是一个非常简单的 <code>Web</code> 应用，点击 <code>Hit me!</code> 按钮会向网站的一个服务端点发起一个 <code>POST</code> 请求，该端点上的 <code>Promethues</code> 装饰器会将该请求记录下来。</p>
<p>每次接收到 <code>POST</code> 请求时，应用程序都会增加一个 <code>Prometheus Counter</code>，我们可以通过应用的 <code>/metrics</code> 接口来获取指标数据，最终我们会将该接口配置到 <code>Prometheus</code> 中定期抓取指标数据。</p>
<pre><code>$ curl -s localhost:8000/metrics | grep demo_app_button_clicks
# HELP demo_app_button_clicks_total Multiprocess metric
# TYPE demo_app_button_clicks_total counter
demo_app_button_clicks_total 0.0
</code></pre>
<p><code>Prometheus Counter（计数器）</code>只会增加：永远不会减少，我们可以在页面上点击下按钮，然后再来看下指标数据的变化，正常来说会得到如下所示的信息：</p>
<pre><code>$ curl -s localhost:8000/metrics | grep demo_app_button_clicks
# HELP demo_app_button_clicks_total Multiprocess metric
# TYPE demo_app_button_clicks_total counter
demo_app_button_clicks_total 3.0
</code></pre>
<h2 id="2-prometheus-operator"><strong>2 安装 Prometheus Operator</strong></h2>
<p>我们这里来使用 <code>Prometheus Operator</code>，这个 <code>Operator</code> 通过抽象化 Prometheus 的部署来我们提供了更加简单方便的方法来使用 Prometheus，执行如下命令在 kube-ops 命名空间下面安装 <code>Prometheus Operator</code>：</p>
<pre><code>helm install stable/prometheus-operator -f helm-values/prometheus-operator-values.yml -n prome-demo --namespace kube-ops
NAME:   prome-demo
LAST DEPLOYED: Mon Nov 18 16:19:55 2019
NAMESPACE: kube-ops
STATUS: DEPLOYED

RESOURCES:
==&gt; v1/ClusterRole
NAME                                       AGE
prome-demo-grafana-clusterrole             35s
prome-demo-prometheus-oper-operator        35s
prome-demo-prometheus-oper-operator-psp    35s
prome-demo-prometheus-oper-prometheus      35s
prome-demo-prometheus-oper-prometheus-psp  35s
psp-prome-demo-kube-state-metrics          35s
psp-prome-demo-prometheus-node-exporter    35s
...

NOTES:
The Prometheus Operator has been installed. Check its status by running:
  kubectl --namespace kube-ops get pods -l &quot;release=prome-demo&quot;

Visit https://github.com/coreos/prometheus-operator for instructions on how
to create &amp; configure Alertmanager and Prometheus instances using the Operator.
</code></pre>
<p>在安装完成后可以使用上面的提示命令来查看 Pod 的状态：</p>
<pre><code>$ kubectl --namespace kube-ops get pods -l &quot;release=prome-demo&quot;
NAME                                                   READY   STATUS    RESTARTS   AGE
prome-demo-grafana-6c774cf988-d9dct                    2/2     Running   0          23h
prome-demo-prometheus-node-exporter-srkr6              1/1     Running   0          23h
prome-demo-prometheus-oper-operator-6f74cf9578-whvdx   2/2     Running   0          23h
</code></pre>
<h3 id="psp-configuration">**可能出现的问题 <code>psp Configuration</code> **</h3>
<pre><code>$ kubectl --namespace kube-ops get pods -l &quot;release=prome-demo&quot;
NAME                                                   READY   STATUS         RESTARTS   AGE
prome-demo-grafana-944f89874-kf8nt                     0/2     Init:Blocked   0          10m
</code></pre>
<p>我们可以看到大部分 <code>Pod</code>都正常了，但是 <code>grafana</code> 这个 <code>Pod</code> 现在是处于 <code>Init:Blocked</code> 状态，我们可以使用 <code>kubectl describe</code> 命令查看下 <code>Pod</code> 的运行事件：</p>
<pre><code>$ kubectl describe pod prome-demo-grafana-944f89874-kf8nt -n kube-ops
Name:               prome-demo-grafana-944f89874-kf8nt
Namespace:          kube-ops
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               ydzs-node2/10.151.30.23
Start Time:         Fri, 27 Sep 2019 09:02:42 +0800
Labels:             app=grafana
                    pod-template-hash=944f89874
                    release=prome-demo
Annotations:        checksum/config: 062340540c04487760c6487c9c4195fdca5ed6521330d6b842b61f3964fcabe4
                    checksum/dashboards-json-config: 01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b
                    checksum/sc-dashboard-provider-config: 511400f9e888cb5ae2906a914e06cbdcb1f19904cf150384c0bb9831723bee45
                    checksum/secret: 5bf8b81f17dbd08ebd81e7e67fd393d5936aeadf8285480e899cd28a92267890
                    container.apparmor.security.beta.kubernetes.io/grafana: runtime/default
                    container.apparmor.security.beta.kubernetes.io/grafana-sc-dashboard: runtime/default
                    container.apparmor.security.beta.kubernetes.io/grafana-sc-datasources: runtime/default
                    kubernetes.io/psp: prome-demo-grafana
                    seccomp.security.alpha.kubernetes.io/pod: docker/default
Status:             Pending
Reason:             AppArmor
Message:            Cannot enforce AppArmor: AppArmor is not enabled on the host
IP:
Controlled By:      ReplicaSet/prome-demo-grafana-944f89874
......
</code></pre>
<p>我们仔细观察其中有一句 <strong><code>Cannot enforce AppArmor: AppArmor is not enabled on the host</code> 这样的 <code>Message</code> 信息</strong>，这是因为我们集群中开启了 <code>PSP</code> 安全策略，而我们使用 <code>Helm</code> 安装 <code>Prometheus Operator</code> 的时候，会给我们添加上一些 <code>PSP</code> 对象：</p>
<pre><code>$ kubectl get psp -l release=prome-demo
NAME                                    PRIV    CAPS   SELINUX    RUNASUSER   FSGROUP     SUPGROUP    READONLYROOTFS   VOLUMES
prome-demo-grafana                      false          RunAsAny   RunAsAny    RunAsAny    RunAsAny    false            configMap,emptyDir,projected,secret,downwardAPI,persistentVolumeClaim
prome-demo-grafana-test                 false          RunAsAny   RunAsAny    RunAsAny    RunAsAny    false            configMap,downwardAPI,emptyDir,projected,secret
prome-demo-prometheus-node-exporter     false          RunAsAny   RunAsAny    MustRunAs   MustRunAs   false            configMap,emptyDir,projected,secret,downwardAPI,persistentVolumeClaim,hostPath
prome-demo-prometheus-oper-operator     false          RunAsAny   RunAsAny    MustRunAs   MustRunAs   false            configMap,emptyDir,projected,secret,downwardAPI,persistentVolumeClaim
prome-demo-prometheus-oper-prometheus   false          RunAsAny   RunAsAny    MustRunAs   MustRunAs   false            configMap,emptyDir,projected,secret,downwardAPI,persistentVolumeClaim
</code></pre>
<p><strong>我们可以编辑 <code>prome-demo-grafana</code> 这个 <code>PSP</code> 对象</strong>：</p>
<pre><code>$ kubectl edit psp prome-demo-grafana
</code></pre>
<p>由于我们集群中没有安装 <code>apparmor</code>，所以我们直接将 <code>annotations</code> 当中的两行数据删除即可：</p>
<pre><code>apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default
apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default
</code></pre>
<h2 id="3"><strong>3 扩容</strong></h2>
<h3 id="3-1"><strong>3-1 部署应用到集群中</strong></h3>
<p>在我们的代码目录下面执行下面的部署命令：</p>
<pre><code>$ kubectl apply -f manifests/deployment.yml -f manifests/service.yml -f manifests/ingress.yml
deployment.apps/prometheus-demo-app created
service/prometheus-demo-app created
</code></pre>
<p>这会创建一个我们应用的 <code>Deployment</code> 和 <code>Service</code> 资源对象到我们集群中，</p>
<blockquote>
<p>此外，还包括一个 <code>Ingress</code> 资源对象，用来暴露给外部用户使用的。</p>
</blockquote>
<pre><code>manifests/ingress.yml
</code></pre>
<ul>
<li><a href="https://github.com/Chao-Xi/JacobTechBlog/blob/master/k8s_tutorial/k8s_adv17_ingress1.md">外部服务发现之 ingress(一)</a></li>
<li><a href="https://github.com/Chao-Xi/JacobTechBlog/blob/master/k8s_tutorial/k8s_adv51_Nginx_Ingress.md"><code>nginx-ingress</code> 的安装使用</a></li>
</ul>
<pre><code>apiVersion: networking.k8s.io/v1beta1
kind: Ingress
metadata:
  name: prometheus-demo-app
spec:
  rules:
    - host: prom-demo.ny152.com
      http:
        paths:
          - path: /
            backend:
              serviceName: prometheus-demo-app
              servicePort: 8080
# apiVersion: traefik.containo.us/v1alpha1
# kind: IngressRoute
# metadata:
#   name: prometheus-demo-app
# spec:
#   entryPoints:
#     - web
#   routes:
#   - match: Host(`prom-demo.ny152.com`)  #注意修改
#     kind: Rule
#     services:
#     - name: prometheus-demo-app
#       port: 8080
</code></pre>
<p>然后为了方便我们在浏览器中访问 <code>Prometheus</code> 的 <code>Dashboard</code>，我们将部署的 <code>Prometheus</code> 的 <code>Service</code> 改成 <code>NodePort</code> 类型：</p>
<pre><code>$ kubectl edit svc prome-demo-prometheus-oper-prometheus -n kube-ops
# 将 spec.type 改成 NodePort

$ kubectl get svc -n kube-ops -l release=prome-demo
NAME                                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)            AGE
prome-demo-grafana                      NodePort    10.106.151.204   &lt;none&gt;        80:31310/TCP       23h
prome-demo-prometheus-node-exporter     ClusterIP   10.111.181.43    &lt;none&gt;        9100/TCP           23h
prome-demo-prometheus-oper-operator     ClusterIP   10.110.17.60     &lt;none&gt;        8080/TCP,443/TCP   23h
prome-demo-prometheus-oper-prometheus   NodePort    10.107.93.192    &lt;none&gt;        9090:31339/TCP     23h
</code></pre>
<p><strong>然后我们就可以通过 <code>http://NodeIP:31339</code> 来访问我们的 <code>Prometheus</code> 页面了，切换到 <code>/targets</code> 页面下面，就会看到正在监控的端点列表了，其中就包括安装 <code>Prometheus Operator</code> 的 <code>CRD</code> 控制器</strong>，当然可能默认情况下有一些监控数据有问题，这个时候就需要我们根据自己集群的实际情况去做对应的调整了：</p>
<p><img alt="Alt Image Text" src="../../images/23_2.png" title="body image" /></p>
<p>接下来我们就来部署我们自己的应用监控，让 Proemthues 也可以抓取到我们自己的应用监控指标数据，执行下面的命令即可：</p>
<pre><code>$ kubectl apply -f manifests/service-monitor.yml
servicemonitor.monitoring.coreos.com/prometheus-demo-app created
</code></pre>
<p><strong>该资源对象内容非常简单，就是一个简单的 <code>ServiceMonitor</code> 对象，<code>ServiceMonitor</code> 是 <code>Prometheus</code> 获取应用监控数据的一个 <code>CRD</code> 对象</strong>，对 <code>ServiceMonitor</code> 不够熟悉的可以查看我们前面的<a href="https://github.com/Chao-Xi/JacobTechBlog/blob/master/k8s_dev/prometheus/11Adv_Prometheus_Operator.md">Prometheus Operator 的相关文档</a></p>
<pre><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: prometheus-demo-app
  namespace: kube-ops
spec:
  endpoints:
  - bearerTokenFile: /var/run/secrets/kubernetes.io/serviceaccount/token
    interval: 15s
    port: web
  selector:
    matchLabels:
      app: prometheus-demo-app
  namespaceSelector:
    matchNames:
    - default
</code></pre>
<p>该对象通知 <code>Prometheus Operator</code> 配置运行中的 <code>Prometheus</code> 实例，监听带有标签 <code>app=prometheus-demo-app</code> 的服务。</p>
<p>现在我们再去 <code>Prometheus</code> 的页面上面查看 <code>/targets</code> 页面就会发现我们的应用已经配置在里面了，然后在 <code>Dashboard</code> 页面上输入下面的 <code>promql</code> 语句：</p>
<p><img alt="Alt Image Text" src="../../images/23_3.png" title="body image" /></p>
<pre><code>demo_app_button_clicks_total
</code></pre>
<p>这个指标就反应出了我们应用程序的所有实例中按钮的总共点击次数。</p>
<p><img alt="Alt Image Text" src="../../images/23_4.png" title="body image" /></p>
<h2 id="4"><strong>4 扩容</strong></h2>
<p>我们这里使用一个名为 <a href="https://github.com/DirectXMan12/k8s-prometheus-adapter/">Prometheus Adapter for Kubernetes Metrics APIs
</a> 的 <code>k8s</code> 的 <code>API</code> 扩展应用，它可以使用用户自定义的 <code>Prometheus</code> 查询来使用 <code>k8s</code> 资源和自定义指标 API。</p>
<p>接下来我们将 <code>Prometheus-Adapter</code> 安装到集群中，并添加一个规则来跟踪每个 Pod 的请求。规则的定义我们可以参考官方文档，每个规则大致可以分为4个部分：</p>
<ul>
<li><code>Discovery</code>：它指定 <code>Adapter</code> 应该<strong>如何找到该规则的所有 <code>Prometheus</code> 指标</strong></li>
<li><code>Association</code>：指定 <code>Adapter</code> 应该如<strong>何确定和特定的指标关联的 <code>Kubernetes</code> 资源</strong></li>
<li><code>Naming</code>：指定 <code>Adapter</code> 应该<strong>如何在自定义指标 <code>API</code> 中暴露指标</strong></li>
<li><code>Querying</code>：指定<strong>如何将对一个获多个 <code>Kubernetes</code> 对象上的特定指标的请求转换为对 <code>Prometheus</code> 的查询</strong></li>
</ul>
<p>下面我们就来编写我们自己的规则，首先添加 <code>rules</code> 熟悉到配置文件中：</p>
<pre><code>rules: []
</code></pre>
<h3 id="4-1-discover"><strong>4-1 discover</strong></h3>
<p>我们这里只需要发现（<code>discover</code>）一个指标 <code>demo_app_button_clicks_total</code>，添加一个非空的 <code>Pod</code> 标签匹配来过滤：</p>
<pre><code>rules:
- seriesQuery: 'demo_app_button_clicks_total{pod!=&quot;&quot;}'
</code></pre>
<h3 id="4-2-association"><strong>4-2 Association</strong></h3>
<p>关联（<code>Association</code>）就非常简单了，<code>Prometheus</code> 标签都直接映射到 <code>Kubernetes</code> 资源（<code>job</code>、<code>namespace</code>、<code>pod</code> 等等），所以我们可以使用一个模板来隐射资源：</p>
<pre><code>rules:
- seriesQuery: 'demo_app_button_clicks_total{pod!=&quot;&quot;}'
  resources: {template: &quot;&lt;&lt;.Resource&gt;&gt;&quot;}
</code></pre>
<h3 id="4-3-naming"><strong>4-3 naming</strong></h3>
<p>我们演示应用的按钮点击总和实际上用处不大，我们需要按照每个 Pod 来进行扩容，然后在规则中添加一个简单的命名（<code>naming</code>）定义：</p>
<pre><code>rules:
- seriesQuery: 'demo_app_button_clicks_total{pod!=&quot;&quot;}'
  resources: {template: &quot;&lt;&lt;.Resource&gt;&gt;&quot;}
  name:
    matches: &quot;^(.*)_total&quot;
    as: &quot;${1}_per_second&quot;
</code></pre>
<h3 id="4-4-querying"><strong>4-4 Querying</strong></h3>
<p>然后就可以定义查询（<code>Querying</code>）了：</p>
<pre><code>seriesQuery: 'demo_app_button_clicks_total{pod!=&quot;&quot;}'
resources: { template: &quot;&lt;&lt;.Resource&gt;&gt;&quot; }
name:
  matches: &quot;^(.*)_total&quot;
  as: &quot;${1}_per_second&quot;
metricsQuery: &quot;sum(rate(&lt;&lt;.Series&gt;&gt;{&lt;&lt;.LabelMatchers&gt;&gt;}[2m])) by (&lt;&lt;.GroupBy&gt;&gt;)&quot;
</code></pre>
<p>这是一个带参数的 <code>Prometheus</code> 查询，其中：</p>
<ul>
<li><code>Series</code> 是有 <code>seriesQuery</code> 匹配的任何 <code>series</code>，该规则只有一个 <code>series</code>，所以我们可以将 <code>demo_app_button_clicks+total</code> 替换成<code>&lt;&lt;.Series&gt;&gt;</code>。</li>
<li><code>&lt;&lt;.LabelMatchers&gt;&gt;</code> 是 <code>adapter</code> 来替换成标签查询的（比如，<code>pod='deployment-name-abcd-1234）</code>。</li>
<li><code>&lt;&lt;.GroupBy&gt;&gt;</code> 表示我们想要扩展的资源，我们这里就是 <code>Pod</code> 了。</li>
</ul>
<p><strong><code>Promethues-Adapter</code> 的一个缺点是配置是通过静态文件和应用程序一起部署的，而不是通过 <code>ConfigMap</code> 或者其他基于 <code>API</code> 的对象来配置的</strong>，</p>
<p>我们这里将使用另外一个 <code>Helm Chart</code> 来部署，通过覆盖 <code>values</code> 文件来配置规则。</p>
<p><code>values</code> 文件放置在项目目录 <code>helm-values/prometheus-adapter-values.yml</code>，内容如下所示：</p>
<pre><code>rules:
  default: false
  custom:
  - seriesQuery: 'demo_app_button_clicks_total'
    resources: { template: &quot;&lt;&lt;.Resource&gt;&gt;&quot; }
    name:
      matches: &quot;^(.*)_total&quot;
      as: &quot;${1}_per_second&quot;
    metricsQuery: &quot;sum(rate(&lt;&lt;.Series&gt;&gt;{&lt;&lt;.LabelMatchers&gt;&gt;}[2m])) by (&lt;&lt;.GroupBy&gt;&gt;)&quot;
prometheus:
  url: http://prom-demo-prometheus-opera-prometheus.default
</code></pre>
<p>使用下面的命令一键安装：</p>
<pre><code>$ helm install stable/prometheus-adapter -n prome-adapter -f helm-values/prometheus-adapter-values.yml --namespace kube-ops
LAST DEPLOYED: Fri Sep 27 10:54:56 2019
NAMESPACE: kube-ops
STATUS: DEPLOYED

RESOURCES:

......

NOTES:
prome-adapter-prometheus-adapter has been deployed.
In a few minutes you should be able to list metrics using the following command(s):

  kubectl get --raw /apis/custom.metrics.k8s.io/v1beta1
</code></pre>
<p>等一小会儿，安装完成后，可以使用下面的命令来检测是否生效了：</p>
<p>正常来说会看到类似于下面的信息：</p>
<pre><code>$ kubectl get --raw=&quot;/apis/custom.metrics.k8s.io/v1beta1&quot; | jq
{
  &quot;kind&quot;: &quot;APIResourceList&quot;,
  &quot;apiVersion&quot;: &quot;v1&quot;,
  &quot;groupVersion&quot;: &quot;custom.metrics.k8s.io/v1beta1&quot;,
  &quot;resources&quot;: [
    {
      &quot;name&quot;: &quot;jobs.batch/demo_app_button_clicks_per_second&quot;,
      &quot;singularName&quot;: &quot;&quot;,
      &quot;namespaced&quot;: true,
      &quot;kind&quot;: &quot;MetricValueList&quot;,
      &quot;verbs&quot;: [
        &quot;get&quot;
      ]
    },
    {
      &quot;name&quot;: &quot;namespaces/demo_app_button_clicks_per_second&quot;,
      &quot;singularName&quot;: &quot;&quot;,
      &quot;namespaced&quot;: false,
      &quot;kind&quot;: &quot;MetricValueList&quot;,
      &quot;verbs&quot;: [
        &quot;get&quot;
      ]
    },
    {
      &quot;name&quot;: &quot;pods/demo_app_button_clicks_per_second&quot;,
      &quot;singularName&quot;: &quot;&quot;,
      &quot;namespaced&quot;: true,
      &quot;kind&quot;: &quot;MetricValueList&quot;,
      &quot;verbs&quot;: [
        &quot;get&quot;
      ]
    },
    {
      &quot;name&quot;: &quot;services/demo_app_button_clicks_per_second&quot;,
      &quot;singularName&quot;: &quot;&quot;,
      &quot;namespaced&quot;: true,
      &quot;kind&quot;: &quot;MetricValueList&quot;,
      &quot;verbs&quot;: [
        &quot;get&quot;
      ]
    }
  ]
}
</code></pre>
<p>接下来，可以获取我们自己 Pod 的指标数据：</p>
<pre><code>$ kubectl get --raw=&quot;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/*/demo_app_button_clicks_per_second?pod=$(kubectl get po -l app=prometheus-demo-app -o name)&quot; | jq
</code></pre>
<p>正常会输出如下所示的一些信息：</p>
<pre><code>$ kubectl get --raw=&quot;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/*/demo_a
pp_button_clicks_per_second?pod=$(kubectl get po -l app=prometheus-demo-app -o name)&quot; | jq
{
  &quot;kind&quot;: &quot;MetricValueList&quot;,
  &quot;apiVersion&quot;: &quot;custom.metrics.k8s.io/v1beta1&quot;,
  &quot;metadata&quot;: {
    &quot;selfLink&quot;: &quot;/apis/custom.metrics.k8s.io/v1beta1/namespaces/default/pods/%2A/demo_app_button_clicks_per_second&quot;
  },
  &quot;items&quot;: [
    {
      &quot;describedObject&quot;: {
        &quot;kind&quot;: &quot;Pod&quot;,
        &quot;namespace&quot;: &quot;default&quot;,
        &quot;name&quot;: &quot;prometheus-demo-app-8585d447c6-77st2&quot;,
        &quot;apiVersion&quot;: &quot;/v1&quot;
      },
      &quot;metricName&quot;: &quot;demo_app_button_clicks_per_second&quot;,
      &quot;timestamp&quot;: &quot;2019-11-18T08:49:26Z&quot;,
      &quot;value&quot;: &quot;0&quot;
    }
  ]
}
</code></pre>
<p>我们可以看到现在的 <code>value</code> 值为<code>0</code>，这是因为我们还没有开始点击页面上面的按钮，所以速率是每秒为<code>0</code>。我们上面部署应用的时候创建了一个 <code>Ingress</code> 对象，所以我们可以通过域名（做好 <code>DNS</code> 解析后）直接访问我们的应用，然后点击页面上面的按钮后，重新来运行上面的命令，我们可以看到速率会增加。</p>
<blockquote>
<p>这里我用的是<code>NodePort</code>的</p>
</blockquote>
<pre><code>$ kubectl edit svc prome-demo-prometheus-oper-prometheus  -n kube-ops
service/prome-demo-grafana edited
</code></pre>
<pre><code>$ kubectl get svc  -n kube-ops
NAME                                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)            AGE
prome-adapter-prometheus-adapter        ClusterIP   10.98.162.83     &lt;none&gt;        443/TCP            17h
prome-demo-grafana                      ClusterIP   10.106.151.204   &lt;none&gt;        80/TCP             17h
prome-demo-kube-state-metrics           ClusterIP   10.107.26.121    &lt;none&gt;        8080/TCP           17h
prome-demo-prometheus-node-exporter     ClusterIP   10.111.181.43    &lt;none&gt;        9100/TCP           17h
prome-demo-prometheus-oper-operator     ClusterIP   10.110.17.60     &lt;none&gt;        8080/TCP,443/TCP   17h
prome-demo-prometheus-oper-prometheus   NodePort    10.107.93.192    &lt;none&gt;        9090:31339/TCP     17h
prometheus-operated                     ClusterIP   None             &lt;none&gt;        9090/TCP           17h
</code></pre>
<pre><code>http://127.0.0.1:31339
</code></pre>
<h2 id="5-hpa"><strong>5 部署 HPA 对象</strong></h2>
<p><code>Pod</code>水平自动伸缩（<code>HPA</code>）可以根据一些特定条件来自动添加新的 <code>Pod</code> 到 <code>Deployment</code> 中去，这里我们添加一个 <code>HPA</code> 对象，<strong>设定目标为每个 <code>Pod</code> 每秒 <code>0.01</code> 次点击</strong>。</p>
<p>接下来我们就来测试下让我们的应用进行自动扩缩容，首先运行下面的命令确保现在只有一个 Pod 正在运行：</p>
<pre><code>$  kubectl get po -l app=prometheus-demo-app
NAME                                   READY   STATUS    RESTARTS   AGE
prometheus-demo-app-8585d447c6-77st2   1/1     Running   0          23h
</code></pre>
<p>然后创建 HPA 对象，对象对应的资源文件位于代码根目录下面 <code>manifests/hpa.yaml</code>，完整的内容如下所示</p>
<pre><code>kind: HorizontalPodAutoscaler
apiVersion: autoscaling/v2beta1
metadata:
  name: prometheus-demo-app
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: prometheus-demo-app
  # autoscale between 1 and 10 replicas
  minReplicas: 1
  maxReplicas: 10
  metrics:
  # use a &quot;Pods&quot; metric, which takes the average of the
  # given metric across all pods controlled by the autoscaling target
  - type: Pods
    pods:
      metricName: demo_app_button_clicks_per_second
      targetAverageValue: 10m
</code></pre>
<p>直接创建这个资源对象即可：</p>
<pre><code>$ kubectl apply -f manifests/hpa.yml
horizontalpodautoscaler.autoscaling/prometheus-demo-app created
</code></pre>
<p>然后重新在浏览器中打开我们的应用，点击一会儿页面上面的按钮，然后重新运行上面的命令，正常我们就可以看到我们的应用的 <code>Deployment</code> 就已经开始扩容了：</p>
<pre><code>$ kubectl get po -l app=prometheus-demo-app
NAME                                   READY   STATUS    RESTARTS   AGE
prometheus-demo-app-8585d447c6-4sls9   1/1     Running   0          5m18s
prometheus-demo-app-8585d447c6-77st2   1/1     Running   0          17h
prometheus-demo-app-8585d447c6-8x59q   1/1     Running   0          5m18s
prometheus-demo-app-8585d447c6-95vtx   1/1     Running   0          5m33s
prometheus-demo-app-8585d447c6-dnklw   1/1     Running   0          5m3s
prometheus-demo-app-8585d447c6-g9scp   1/1     Running   0          5m18s
prometheus-demo-app-8585d447c6-kmkvk   1/1     Running   0          5m3s
prometheus-demo-app-8585d447c6-rtf5x   1/1     Running   0          5m18s
prometheus-demo-app-8585d447c6-stxpw   1/1     Running   0          5m33s
prometheus-demo-app-8585d447c6-wtwv5   1/1     Running   0          5m33s
</code></pre>
<p>到这里我们就完成了使用自定义的指标数据对应用进行自动扩缩容的操作。</p>
<h2 id="6-grafana"><strong>6 在 <code>Grafana</code> 中显示缩放数据</strong></h2>
<p>这部分内容其实不是必须的，只是单纯的在图表上对我们的缩放数据进行展示，这可以增加我们对整个过程的理解。</p>
<p>我们将我们需要使用到的 grafana 的 Dashboard 数据放置在了代码根目录下面 manifests/<code>grafana-dashboard-configmap.yml</code>，先通过 <code>ConfigMap</code> 来创建这个 Dashboard 数据：</p>
<pre><code>$ kubectl apply -f manifests/grafana-dashboard-configmap.yml
</code></pre>
<p>同样为了方便我们访问，将 <code>Prometheus Operator</code> 不是的 <code>grafana</code> 的 <code>Service</code> 更改成 <code>NodePort</code> 类型：</p>
<pre><code>$ kubectl edit svc prome-demo-grafana -n kube-ops
service/prome-demo-grafana edited

$ kubectl get svc
NAME                  TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
kubernetes            ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          6d5h
prometheus-demo-app   NodePort    10.108.214.168   &lt;none&gt;        8080:30062/TCP   23h
</code></pre>
<p><img alt="Alt Image Text" src="../../images/23_5.png" title="body image" /></p>
<p>这个时候同样我就可以用 <code>http://NodeIP:30062</code> 来访问 <code>grafana</code> 应用了。默认的用户名为 <code>admin</code>，默认的密码为：<code>prom-operator</code>，进入页面后，可以选择我们上面创建的 <code>Prometheus Demo App Dashboard</code> 这个 <code>Dashboard</code>，我们可以看到应用在扩缩容的完整过程：</p>
<p><img alt="Alt Image Text" src="../../images/23_6.png" title="body image" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>