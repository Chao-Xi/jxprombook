
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Jacob's Prometheus 技术实战教程">
      
      
        <meta name="author" content="Jacob Xi">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.5.2">
    
    
      
        <title>3 PromQL 内置函数 - Jacob Prometheus Book</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9f9400aa.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#ffa724">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="orange" data-md-color-accent="orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#3-promql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Jacob Prometheus Book" class="md-header__button md-logo" aria-label="Jacob Prometheus Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Jacob Prometheus Book
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3 PromQL 内置函数
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chao-Xi/jxprombook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxprombook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Jacob Prometheus Book" class="md-nav__button md-logo" aria-label="Jacob Prometheus Book" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    Jacob Prometheus Book
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chao-Xi/jxprombook.git" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    jxprombook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Prometheus技术介绍,K8S Metrics介绍&查看
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus技术介绍,K8S Metrics介绍&查看" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Prometheus技术介绍,K8S Metrics介绍&查看
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/57prometheus_best_practice/" class="md-nav__link">
        第零节 Promethues 应用监控的一些实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/1prometheus2022/" class="md-nav__link">
        第一节 Prometheus 系统介绍 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/18Adv_Prometheus_index_classfication/" class="md-nav__link">
        第二节 深入Prometheus设计-指标定义与分类(PromQL)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/k8s_adv39_kube_state_metrics/" class="md-nav__link">
        第三节 kube-state-metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/17Adv_K8S_Metrics_Server/" class="md-nav__link">
        第四节 Metrics Server 安装
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/20Install_metrics_server_SAP_CC/" class="md-nav__link">
        第五节 Install Kubernetes Metrics Server on SAP Converged Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/38k8s_hpa_metricsserver/" class="md-nav__link">
        第六节 Kubernetes HPA 使用详解(Metrics Server/CPU/Mem/adapater)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/55prometheus_go_metrics/" class="md-nav__link">
        第七节 为Go应用添加Prometheus监控指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/37kubectl_top/" class="md-nav__link">
        第八节 从kubectl top看K8S监控原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap1/9kube-state-metrics_crd/" class="md-nav__link">
        第九节 通过 kube-state-metrics 添加 CRD 状态指标
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Prometheus on Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus on Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Prometheus on Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/19centos7_Prometheus_Alertmanager_Grafana/" class="md-nav__link">
        第一节 Centos7 Prometheus安装部署+监控+绘图+告警
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/59node_exporter/" class="md-nav__link">
        第二节 使用Node Exporter监控Linux主机&常用监控指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/36Prometheus_Mysql/" class="md-nav__link">
        第三节 基于Prometheus构建MySQL可视化监控平台
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/4mysql_exporter/" class="md-nav__link">
        第四节 官方 mysqld_exporter支持抓取多MySQL实例
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap2/5prom_grafana_chatops/" class="md-nav__link">
        第五节 使用 Grafana、Prometheus 和 Slack 构建一个简单的 ChatOps 机器人
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          手动部署Kubernetes Prometheus
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="手动部署Kubernetes Prometheus" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          手动部署Kubernetes Prometheus
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/1prometheus_setup/" class="md-nav__link">
        第一节 Kubernetes使用Prometheus搭建监控平台(2018)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/2prometheus_AlertManager/" class="md-nav__link">
        第二节 Prometheus报警 && AlertManager实战（2018）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/3changes_on_Grafana/" class="md-nav__link">
        第三节 Grafana 显示参数设置(2018)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/4Adv_Prometheus_setup/" class="md-nav__link">
        第四节 在 Kubernetes 中手动部署 Prometheus (adv)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/5Adv_Prometheus_monitor/" class="md-nav__link">
        第五节 应用监控（Metrics/Exporter的配置）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/6Adv_K8S_Nodes_monitor/" class="md-nav__link">
        第六节 监控K8S集群节点&Node-exporter DaemonSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/7Adv_K8S_Resource_monitor/" class="md-nav__link">
        第七节 监控常用资源对象（容器/apiserver/Service监控/kube-state-metric）
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/8Adv_K8S_Grafana/" class="md-nav__link">
        第八节 Grafana 在 Kubernetes 中的使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/10Adv_k8s_AlertManger/" class="md-nav__link">
        第九节 报警神器 AlertManager 的使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/16Adv_Prometheus_Del_index/" class="md-nav__link">
        第十节 Prometheus 删除数据指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/50PrometheusAlert/" class="md-nav__link">
        第十一节 Prometheus中使用PrometheusAlert进行聚合报警
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/12gpu_monitor/" class="md-nav__link">
        第十二节 监控Kubernetes集群的GPU资源
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/29AlertManager_SendAlerts_when/" class="md-nav__link">
        第十三节 AlertManager何时报警
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap3/41Prometheus_Monitor_OutCluster/" class="md-nav__link">
        第十四节 Prometheus监控外部Kubernetes集群
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          玩转Prometheus Operator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="玩转Prometheus Operator" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          玩转Prometheus Operator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/11Adv_Prometheus_Operator/" class="md-nav__link">
        第一节 Prometheus Operator 初体验
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/13Adv_Prometheus_Operator_etcd/" class="md-nav__link">
        第二节 使用 Prometheus Operator 监控 etcd
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/14Adv_Prometheus_Operator_alarm/" class="md-nav__link">
        第三节 Prometheus Operator 自定义报警
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/22Customize_Alert_Email/" class="md-nav__link">
        第四节 Add Custom Alert and Send Alert Email with Alertmanager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/24Kubernetes_Prometheus_blackbox/" class="md-nav__link">
        第五节 Prometheus 黑盒监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/32Prometheus_troubleshoot_Servicemonitor/" class="md-nav__link">
        第六节 Troubleshooting ServiceMonitor changes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/43Prometheus_operator_ssl_exporter/" class="md-nav__link">
        第七节 使用ssl_exporter监控K8S集群证书
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/44Prometheus_KubeNurse/" class="md-nav__link">
        第八节 Operator2021-使用KubeNurse进行集群网络监控
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/45Prom-operator_2021/" class="md-nav__link">
        第九节 Prometheus Operator安装配置(2021)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/46Prometheus_traefik/" class="md-nav__link">
        第十节 Traefik之使用Prometheus Operator进行监控报警2021
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/47Prometheus_opt_AlertmanagerConfig/" class="md-nav__link">
        第十一节 Operator使用AlertmanagerConfig进行报警配置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/49Prometheus_SLI_SLO/" class="md-nav__link">
        第十二节 通过Prometheus来做SLI/SLO监控展示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/51missing-container-metrics/" class="md-nav__link">
        第十三节 Prometheus使用missing-container-metrics监控Pod oomkill
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap4/chap4_blackbox/" class="md-nav__link">
        第十四节 如何在Prometheus中进行黑盒监控(ICMP/DNS/TCP/HTTP/gRPC)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Prometheus服务发现
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus服务发现" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Prometheus服务发现
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/53Prometheus_auto_discovery/" class="md-nav__link">
        第一节 Prometheus服务的自动发现使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/52Prometheus_Relabeling/" class="md-nav__link">
        第二节 Prometheus Relabeling重新标记的使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap5/54prometheus_go_metrics_guideline/" class="md-nav__link">
        第三节 如何使用Prometheus仪表化应用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Jam prometheus Monitor
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Jam prometheus Monitor" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Jam prometheus Monitor
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/25Alertmanager_AWS_SES/" class="md-nav__link">
        Chap1 Alertmanager alerts with Amazon SES SMTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/26Prometheus_Monitor_Argocd/" class="md-nav__link">
        Chap2 Prometheus Operator Monitor on ArgoCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/27Prometheus_Monitor_elasticsearch/" class="md-nav__link">
        Chap3 Prometheus Operator Monitor on ElasticSearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/31Prometheus_Monitor_rabbitmq/" class="md-nav__link">
        Chap4 Prometheus Operator Monitor on Rabbitmq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap6/33Prometheus_Monitor_memcached/" class="md-nav__link">
        Chap5 Prometheus Operator Monitor on Memcached
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Prometheus-Adapter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus-Adapter" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Prometheus-Adapter
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap7/23Kubernetes_Scale_Prometheus-Adapter/" class="md-nav__link">
        应用进行自定义指标扩缩容 by Prometheus-Adapter and Flask-Exporter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          PromQL学习
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PromQL学习" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          PromQL学习
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1Promql_basic1/" class="md-nav__link">
        1 初识 PromQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2Promql_basic2/" class="md-nav__link">
        2 PromQL 操作符 & 内置函数
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          3 PromQL 内置函数
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        3 PromQL 内置函数
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abs" class="md-nav__link">
    abs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#absent" class="md-nav__link">
    absent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ceil" class="md-nav__link">
    ceil()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes" class="md-nav__link">
    changes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clamp_max" class="md-nav__link">
    clamp_max()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clamp_min" class="md-nav__link">
    clamp_min()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day_of_month" class="md-nav__link">
    day_of_month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day_of_week" class="md-nav__link">
    day_of_week()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#days_in_month" class="md-nav__link">
    days_in_month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta" class="md-nav__link">
    delta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriv" class="md-nav__link">
    deriv()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exp" class="md-nav__link">
    exp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#floor" class="md-nav__link">
    floor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#histogram_quantile" class="md-nav__link">
    histogram_quantile()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#holt_winters" class="md-nav__link">
    holt_winters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hour" class="md-nav__link">
    hour()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#idelta" class="md-nav__link">
    idelta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#increase" class="md-nav__link">
    increase()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#irate" class="md-nav__link">
    irate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#label_join" class="md-nav__link">
    label_join()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#label_replace" class="md-nav__link">
    label_replace()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ln" class="md-nav__link">
    ln()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log2" class="md-nav__link">
    log2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log10" class="md-nav__link">
    **log10()**
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minute" class="md-nav__link">
    minute()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#month" class="md-nav__link">
    month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predict_linear" class="md-nav__link">
    predict_linear()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate" class="md-nav__link">
    rate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resets" class="md-nav__link">
    resets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#round" class="md-nav__link">
    round()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalar" class="md-nav__link">
    scalar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sort" class="md-nav__link">
    sort()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sort_desc" class="md-nav__link">
    sort_desc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqrt" class="md-nav__link">
    sqrt()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time" class="md-nav__link">
    time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    timestamp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector" class="md-nav__link">
    vector()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#year" class="md-nav__link">
    year()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation_over_time" class="md-nav__link">
    &lt;aggregation&gt;_over_time()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../4Promql_basic4/" class="md-nav__link">
        4 PromQL简单示例
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../5Promql_basic5/" class="md-nav__link">
        5 在 HTTP API中使用 PromQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../6Promql_adv1/" class="md-nav__link">
        6 Prometheus记录规则的使用(Recording Rule)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../56prometheus_promql_rate/" class="md-nav__link">
        7 PromQL查询之rate函数的使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../60prometheus_job/" class="md-nav__link">
        8 解决Prometheus监控Kubernetes Job误报的坑
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../9promql_6errors/" class="md-nav__link">
        9 使用 Prometheus PromQL时需要避免这6个错误
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Awesome alerts rules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Awesome alerts rules" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Awesome alerts rules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/1basic_resource/" class="md-nav__link">
        1 Basic resource monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/2database_broker/" class="md-nav__link">
        2 Databases and brokers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/3proxy_lb/" class="md-nav__link">
        3 Reverse proxies and load balancers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/4runtimes/" class="md-nav__link">
        4 Runtimes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/5Orchestrators/" class="md-nav__link">
        5 Orchestrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/6network_sec_storage/" class="md-nav__link">
        6 Network, security and storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/7other/" class="md-nav__link">
        7 Others
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap9/8Alerting_sleep/" class="md-nav__link">
        8 Alert Sleep Peacefully
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          数据可视化&Grafana Plugin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="数据可视化&Grafana Plugin" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          数据可视化&Grafana Plugin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/58grafana_init/" class="md-nav__link">
        1 使用 Grafana 构建你的第一个仪表盘
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/28Grafana_plugin_DevOpsProdigy/" class="md-nav__link">
        2 优秀的Grafana K8S 插件-DevOpsProdigy KubeGraf
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/30Create_Grafana_dashboards/" class="md-nav__link">
        3 用 Kubernetes darks资源对象创建Grafana Dashboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/48grafana_Trickster/" class="md-nav__link">
        4 Grafana 图表加速神器-Trickster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap10/5Grafana_Loki/" class="md-nav__link">
        5 使用读写分离模式扩展 Grafana Loki
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      
      
      
        <label class="md-nav__link" for="__nav_12">
          Prometheus(OpenTelemetry)架构设计与工具平台
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Prometheus(OpenTelemetry)架构设计与工具平台" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Prometheus(OpenTelemetry)架构设计与工具平台
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/1deepflow/" class="md-nav__link">
        1 DeepFlow AutoTagging之Prometheus标签标准化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/2Prometheus_opentele/" class="md-nav__link">
        2 Prometheus与OpenTelemetry该选哪个？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/3Prometheus_index/" class="md-nav__link">
        3 Prometheus的四种指标类型
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap13/4OpenTelemetry/" class="md-nav__link">
        4 透彻理解OpenTelemetry
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          Thanos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Thanos" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Thanos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/39Thanos_tutorial/" class="md-nav__link">
        第一节 大规模场景下Prometheus的优化手段&Thanos架构详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/34Thanos_intro/" class="md-nav__link">
        第二节 使用Thanos实现Prometheus的高可用介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/35Thanos_install/" class="md-nav__link">
        第三节 Prometheus高可用Thanos学习-sidercar和query&Thanos部署
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/61thanos_sidecar_receiver/" class="md-nav__link">
        第四节（2022）如何选择Thanos的Sidecar和Receiver两种模式？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/62thanos_query/" class="md-nav__link">
        第五节（2022）使用Thanos查询前端优化查询性能
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/63prometheus_optimiztion/" class="md-nav__link">
        第六节 (Thaos1-2022)大规模场景下Prometheus的优化手段
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/64thanos_detail/" class="md-nav__link">
        第七节 (Thaos2-2022)Thanos架构详解
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/65thanos_setup/" class="md-nav__link">
        第八节 (Thaos3-2022)Thanos部署与实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap11/66thanos_ruler/" class="md-nav__link">
        第九节（2022）Thanos Ruler组件的使用
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_14" type="checkbox" id="__nav_14" >
      
      
      
      
        <label class="md-nav__link" for="__nav_14">
          VictoriaMetrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="VictoriaMetrics" data-md-level="1">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          VictoriaMetrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/67vm_intro/" class="md-nav__link">
        第一节 Prometheus远程存储VictoriaMetrics简介
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/68vm_setup/" class="md-nav__link">
        第二节 Prometheus长期远程存储方案VictoriaMetrics入门实践
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/69vm_cluster/" class="md-nav__link">
        第三节 VictorialMetrics 集群模式的使用
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/70vm_vmagent/" class="md-nav__link">
        第四节 使用vmagent代替Prometheus采集监控指标
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/71vm_operator/" class="md-nav__link">
        第五节 使用Victoria Metrics Operator管理VM集群
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/72vm_vmalert/" class="md-nav__link">
        第六节 使用 vmalert 代替 Prometheus 监控报警
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap12/73vm_pressure/" class="md-nav__link">
        第七节 对Prometheus兼容的时序数据库进行压力测试
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_15" type="checkbox" id="__nav_15" >
      
      
      
      
        <label class="md-nav__link" for="__nav_15">
          APM 工具及功能介绍
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="APM 工具及功能介绍" data-md-level="1">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          APM 工具及功能介绍
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/1apm_prods/" class="md-nav__link">
        第一节 APM产品落地实战
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/2opentracing/" class="md-nav__link">
        第二节 APM + OpenTracing原理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/3apm_tracing/" class="md-nav__link">
        第三节 怎么理解分布式链路追踪技术？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/4apm_prod/" class="md-nav__link">
        第四节 在生产环境中如何选择靠谱的APM系统？
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/5apm_Sentry/" class="md-nav__link">
        第五节 Sentry+OpenTelemetry前后端全链路打通
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chap_apm/6k8s_watching/" class="md-nav__link">
        第六节 聊聊可观测性之数据模型
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#abs" class="md-nav__link">
    abs()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#absent" class="md-nav__link">
    absent()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ceil" class="md-nav__link">
    ceil()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes" class="md-nav__link">
    changes()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clamp_max" class="md-nav__link">
    clamp_max()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clamp_min" class="md-nav__link">
    clamp_min()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day_of_month" class="md-nav__link">
    day_of_month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#day_of_week" class="md-nav__link">
    day_of_week()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#days_in_month" class="md-nav__link">
    days_in_month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta" class="md-nav__link">
    delta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriv" class="md-nav__link">
    deriv()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exp" class="md-nav__link">
    exp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#floor" class="md-nav__link">
    floor()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#histogram_quantile" class="md-nav__link">
    histogram_quantile()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#holt_winters" class="md-nav__link">
    holt_winters()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hour" class="md-nav__link">
    hour()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#idelta" class="md-nav__link">
    idelta()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#increase" class="md-nav__link">
    increase()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#irate" class="md-nav__link">
    irate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#label_join" class="md-nav__link">
    label_join()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#label_replace" class="md-nav__link">
    label_replace()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ln" class="md-nav__link">
    ln()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log2" class="md-nav__link">
    log2()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log10" class="md-nav__link">
    **log10()**
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minute" class="md-nav__link">
    minute()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#month" class="md-nav__link">
    month()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predict_linear" class="md-nav__link">
    predict_linear()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate" class="md-nav__link">
    rate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resets" class="md-nav__link">
    resets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#round" class="md-nav__link">
    round()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalar" class="md-nav__link">
    scalar()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sort" class="md-nav__link">
    sort()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sort_desc" class="md-nav__link">
    sort_desc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqrt" class="md-nav__link">
    sqrt()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time" class="md-nav__link">
    time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp" class="md-nav__link">
    timestamp()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vector" class="md-nav__link">
    vector()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#year" class="md-nav__link">
    year()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation_over_time" class="md-nav__link">
    &lt;aggregation&gt;_over_time()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/Chao-Xi/jxprombook.git/edit/master/docs/chap8/3Promql_basic3.md" title="编辑此页" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="3-promql"><strong>3 PromQL 内置函数</strong></h1>
<p><code>Prometheus</code> 提供了其它大量的内置函数，可以对时序数据进行丰富的处理。某些函数有默认的参数，例如：<code>year(v=vector(time()) instant-vector)</code>。其中参数 <code>v</code> 是一个瞬时向量，如果不提供该参数，将使用默认值 <code>vector(time())</code>。<code>instant-vector</code> 表示参数类型。</p>
<h3 id="abs"><strong><code>abs()</code></strong></h3>
<p><code>abs(v instant-vector)</code> 返回输入向量的所有样本的绝对值。</p>
<h3 id="absent"><strong><code>absent()</code></strong></h3>
<ul>
<li><code>absent(v instant-vector)</code>，如果传递给它的向量参数具有样本数据，则返回空向量；</li>
<li>如果传递的向量参数没有样本数据，则返回不带度量指标名称且带有标签的时间序列，且样本值为1。</li>
</ul>
<p>当监控度量指标时，如果获取到的样本数据是空的， 使用 <code>absent</code> 方法对告警是非常有用的。例如：</p>
<pre><code># 这里提供的向量有样本数据
absent(http_requests_total{method=&quot;get&quot;})  =&gt; no data
absent(sum(http_requests_total{method=&quot;get&quot;}))  =&gt; no data

# 由于不存在度量指标 nonexistent，所以 返回不带度量指标名称且带有标签的时间序列，且样本值为1
absent(nonexistent{job=&quot;myjob&quot;})  =&gt; {job=&quot;myjob&quot;}  1
# 正则匹配的 instance 不作为返回 labels 中的一部分
absent(nonexistent{job=&quot;myjob&quot;,instance=~&quot;.*&quot;})  =&gt; {job=&quot;myjob&quot;}  1

# sum 函数返回的时间序列不带有标签，且没有样本数据
absent(sum(nonexistent{job=&quot;myjob&quot;}))  =&gt; {}  1
</code></pre>
<h3 id="ceil"><strong><code>ceil()</code></strong></h3>
<p><code>ceil(v instant-vector)</code> 将 <code>v</code> 中所有元素的样本值向上四舍五入到最接近的整数。例如：</p>
<pre><code>node_load5{instance=&quot;192.168.1.75:9100&quot;} # 结果为 2.79
ceil(node_load5{instance=&quot;192.168.1.75:9100&quot;}) # 结果为 3
</code></pre>
<h3 id="changes"><strong><code>changes()</code></strong></h3>
<p><code>changes(v range-vector)</code> 输入一个区间向量， <strong>返回这个区间向量内每个样本数据值变化的次数（瞬时向量）</strong>。例如：</p>
<pre><code># 如果样本数据值没有发生变化，则返回结果为 1
changes(node_load5{instance=&quot;192.168.1.75:9100&quot;}[1m]) # 结果为 1
</code></pre>
<h3 id="clamp_max"><strong><code>clamp_max()</code></strong></h3>
<p><strong><code>clamp_max(v instant-vector, max scalar)</code> 函数，输入一个瞬时向量和最大值</strong>，样本数据值若大于 <code>max</code>，则改为 <code>max</code>，否则不变。例如：</p>
<pre><code>node_load5{instance=&quot;192.168.1.75:9100&quot;} # 结果为 2.79
clamp_max(node_load5{instance=&quot;192.168.1.75:9100&quot;}, 2) # 结果为 2
</code></pre>
<h3 id="clamp_min"><strong><code>clamp_min()</code></strong></h3>
<p><code>clamp_min(v instant-vector, min scalar)</code> 函数，输入一个瞬时向量和最小值，样本数据值若小于 min，则改为 min，否则不变。例如：</p>
<pre><code>node_load5{instance=&quot;192.168.1.75:9100&quot;} # 结果为 2.79
clamp_min(node_load5{instance=&quot;192.168.1.75:9100&quot;}, 3) # 结果为 3
</code></pre>
<h3 id="day_of_month"><strong><code>day_of_month()</code></strong></h3>
<p><code>day_of_month(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在月的第几天。返回值范围：<code>1~31</code>。</p>
<h3 id="day_of_week"><strong><code>day_of_week()</code></strong></h3>
<p><code>day_of_week(v=vector(time()) instant-vector)</code> 函数，返回被给定 UTC 时间所在周的第几天。返回值范围：<code>0~6</code>，<code>0</code> 表示星期天。</p>
<h3 id="days_in_month"><strong><code>days_in_month()</code></strong></h3>
<p><code>days_in_month(v=vector(time()) instant-vector)</code>函数，返回当月一共有多少天。返回值范围：<code>28~31</code>。</p>
<h3 id="delta"><strong><code>delta()</code></strong></h3>
<p><code>delta(v range-vector)</code> 的参数是一个区间向量，返回一个瞬时向量。它计算一个区间向量 <code>v</code> 的第一个元素和最后一个元素之间的差值。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p>
<p>例如，<strong>下面的例子返回过去两小时的 CPU 温度差</strong>：</p>
<pre><code>delta(cpu_temp_celsius{host=&quot;zeus&quot;}[2h])
</code></pre>
<p>这个函数一般只用在 Gauge 类型的时间序列上。</p>
<h3 id="deriv"><strong><code>deriv()</code></strong></h3>
<p><code>deriv(v range-vector)</code> 的参数是一个区间向量,返回一个瞬时向量。它使用简单的线性回归计算区间向量 v 中各个时间序列的导数。</p>
<p>这个函数一般只用在 <code>Gauge</code> 类型的时间序列上。</p>
<h3 id="exp"><strong><code>exp()</code></strong></h3>
<p><code>exp(v instant-vector)</code> 函数，输入一个瞬时向量，返回各个样本值的 <code>e</code> 的指数值，即 <code>e</code>的 <code>N</code> 次方。当<code>N</code> 的值足够大时会返回<code>+Inf</code>。特殊情况为：</p>
<ul>
<li><code>Exp(+Inf) = +Inf</code></li>
<li><code>Exp(NaN) = NaN</code></li>
</ul>
<h3 id="floor"><strong><code>floor()</code></strong></h3>
<p><code>floor(v instant-vector)</code> 函数与 <code>ceil()</code> 函数相反，将 <code>v</code>中所有元素的样本值向下四舍五入到最接近的整数。</p>
<h3 id="histogram_quantile"><strong><code>histogram_quantile()</code></strong></h3>
<p><code>histogram_quantile(φ float, b instant-vector)</code> 从 <code>bucket</code> 类型的向量 <code>b</code> 中计算 <code>φ (0 ≤ φ ≤ 1)</code> 分位数（百分位数的一般形式）的样本的最大值。</p>
<p>（有关 φ 分位数的详细说明以及直方图指标类型的使用，请参阅直方图和摘要）。向量<code>b</code> 中的样本是每个 <code>bucket</code> 的采样点数量。每个样本的 <code>labels</code> 中必须要有 <code>le</code> 这个 <code>label</code> 来表示每个 <code>bucket</code> 的上边界，没有 <code>le</code> 标签的样本会被忽略。</p>
<p>直方图指标类型自动提供带有 <code>_bucket</code> 后缀和相应标签的时间序列。</p>
<p>可以使用 <code>rate()</code> 函数来指定分位数计算的时间窗口。</p>
<p>例如，</p>
<p>一个直方图指标名称为 <code>employee_age_bucket_bucket</code>，要计算过去 <code>10</code>分钟内 第 <code>90</code> 个百分位数，请使用以下表达式：</p>
<pre><code>histogram_quantile(0.9, rate(employee_age_bucket_bucket[10m]))
</code></pre>
<p>返回：</p>
<pre><code>{instance=&quot;10.0.86.71:8080&quot;,job=&quot;prometheus&quot;} 35.714285714285715
</code></pre>
<p>这表示最近 <code>10</code> 分钟之内 <code>90%</code> 的样本的最大值为 <code>35.714285714285715</code>。</p>
<p>这个计算结果是每组标签组合成一个时间序列。我们可能不会对所有这些维度（如 <code>job</code>、<code>instance</code> 和<code>method</code>）感兴趣，并希望将其中的一些维度进行聚合，则可以使用 <code>sum()</code> 函数。例如，以下表达式根据 job 标签来对第 90 个百分位数进行聚合：</p>
<pre><code># histogram_quantile() 函数必须包含 le 标签
histogram_quantile(0.9, sum(rate(employee_age_bucket_bucket[10m])) by (job, le))
</code></pre>
<p>如果要聚合所有的标签，则使用如下表达式：</p>
<pre><code>histogram_quantile(0.9,sum(rate(employee_age_bucket_bucket[10m])) by (le))
</code></pre>
<h3 id="holt_winters"><strong><code>holt_winters()</code></strong></h3>
<p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code> 函数基于区间向量 <code>v</code>，<strong>生成时间序列数据平滑值</strong>。平滑因子 <code>sf</code> 越低, 对旧数据的重视程度越高。趋势因子<code>tf</code> 越高，对数据的趋势的考虑就越多。其中，<code>0&lt; sf</code>, <code>tf &lt;=1</code>。</p>
<p><code>holt_winters</code> 仅适用于 <code>Gauge</code> 类型的时间序列。</p>
<h3 id="hour"><strong><code>hour()</code></strong></h3>
<p><code>hour(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前第几个小时，时间范围：<code>0~23</code>。</p>
<h3 id="idelta"><strong><code>idelta()</code></strong></h3>
<p><code>idelta(v range-vector)</code> 的参数是一个区间向量, 返回一个瞬时向量。它计算最新的 2 个样本值之间的差值。</p>
<p>这个函数一般只用在 Gauge 类型的时间序列上。</p>
<h3 id="increase"><strong><code>increase()</code></strong></h3>
<p><code>increase(v range-vector)</code> 函数获取区间向量中的第一个和最后一个样本并返回其增长量, 它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值。</p>
<p>例如，<strong>以下表达式返回区间向量中每个时间序列过去 <code>5</code> 分钟内 <code>HTTP</code>请求数的增长数</strong>：</p>
<pre><code>increase(http_requests_total{job=&quot;apiserver&quot;}[5m])
</code></pre>
<p><code>increase</code> 的返回值类型只能是计数器类型，主要作用是增加图表和数据的可读性。使用 <code>rate</code> 函数记录规则的使用率，以便持续跟踪数据样本值的变化。</p>
<h3 id="irate">irate()</h3>
<p><code>irate(v range-vector)</code> 函数用于计算区间向量的增长率，但是其反应出的是瞬时增长率。<code>irate</code> 函数是通过区间向量中最后两个两本数据来计算区间向量的增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。这种方式可以避免在时间窗口范围内的“长尾问题”，并且体现出更好的灵敏度，通过irate函数绘制的图标能够更好的反应样本数据的瞬时变化状态。</p>
<p>例如，以下表达式返回<strong>区间向量中每个时间序列过去 5 分钟内最后两个样本数据的 HTTP 请求数的增长率</strong>：</p>
<pre><code>irate(http_requests_total{job=&quot;api-server&quot;}[5m])
</code></pre>
<p><code>irate</code> 只能用于绘制快速变化的计数器，在长期趋势分析或者告警中更推荐使用 <code>rate</code> 函数。因为使用 <code>irate</code> 函数时，速率的简短变化会重置 <code>FO</code>R 语句，形成的图形有很多波峰，难以阅读。</p>
<blockquote>
<p>当将 <code>irate()</code> 函数与聚合运算符（例如 <code>sum()</code>）或随时间聚合的函数（任何以 _over_time 结尾的函数）一起使用时，必须先执行 irate 函数，然后再进行聚合操作，否则当采样目标重新启动时 irate() 无法检测到计数器是否被重置。</p>
</blockquote>
<h3 id="label_join"><strong><code>label_join()</code></strong></h3>
<p><code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code></p>
<p>函数可以将时间序列 <code>v</code> 中多个标签 <code>src_label</code> 的值，通过 <code>separator</code>作为连接符写入到一个新的标签 <code>dst_label</code> 中。可以有多个 <code>src_label</code> 标签。</p>
<p>例如，以下表达式返回的时间序列多了一个 <code>foo</code> 标签，标签值为 <code>etcd,etcd-k8s</code>：</p>
<pre><code>up{endpoint=&quot;api&quot;,instance=&quot;192.168.123.248:2379&quot;,job=&quot;etcd&quot;,namespace=&quot;monitoring&quot;,service=&quot;etcd-k8s&quot;}
=&gt; up{endpoint=&quot;api&quot;,instance=&quot;192.168.123.248:2379&quot;,job=&quot;etcd&quot;,namespace=&quot;monitoring&quot;,service=&quot;etcd-k8s&quot;}  1

label_join(up{endpoint=&quot;api&quot;,instance=&quot;192.168.123.248:2379&quot;,job=&quot;etcd&quot;,namespace=&quot;monitoring&quot;,service=&quot;etcd-k8s&quot;}, &quot;foo&quot;, &quot;,&quot;, &quot;job&quot;, &quot;service&quot;)
=&gt; up{endpoint=&quot;api&quot;,foo=&quot;etcd,etcd-k8s&quot;,instance=&quot;192.168.123.248:2379&quot;,job=&quot;etcd&quot;,namespace=&quot;monitoring&quot;,service=&quot;etcd-k8s&quot;}  1
</code></pre>
<h3 id="label_replace"><strong><code>label_replace()</code></strong></h3>
<p>为了能够让客户端的图标更具有可读性，可以通过 <code>label_replace</code> 函数为时间序列添加额外的标签。<code>label_replace</code> 的具体参数如下：</p>
<pre><code>label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)
</code></pre>
<p>该函数会依次对 <code>v</code> 中的每一条时间序列进行处理，通过 <code>regex</code> 匹配 <code>src_label</code> 的值，并将匹配部分 <code>relacement</code> 写入到 <code>dst_label</code> 标签中。如下所示：</p>
<pre><code>label_replace(up, &quot;host&quot;, &quot;$1&quot;, &quot;instance&quot;,  &quot;(.*):.*&quot;)
</code></pre>
<p>函数处理后，时间序列将包含一个 <code>host</code> 标签，host 标签的值为 Exporter 实例的 IP 地址：</p>
<pre><code>up{host=&quot;localhost&quot;,instance=&quot;localhost:8080&quot;,job=&quot;cadvisor&quot;}   1
up{host=&quot;localhost&quot;,instance=&quot;localhost:9090&quot;,job=&quot;prometheus&quot;}   1
up{host=&quot;localhost&quot;,instance=&quot;localhost:9100&quot;,job=&quot;node&quot;}   1
</code></pre>
<h3 id="ln"><strong><code>ln()</code></strong></h3>
<p><code>ln(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的自然对数。特殊情况：</p>
<ul>
<li><code>ln(+Inf) = +Inf</code></li>
<li><code>ln(0) = -Inf</code></li>
<li><code>ln(x &lt; 0) = NaN</code></li>
<li><code>ln(NaN) = NaN</code></li>
</ul>
<h3 id="log2"><strong><code>log2()</code></strong></h3>
<p><code>log2(v instant-vector)</code> 函数计算瞬时向量 v 中所有样本数据的二进制对数。特殊情况同上。</p>
<h3 id="log10"><code>**log10()</code>**</h3>
<p><code>log10(v instant-vector)</code> 计算瞬时向量 v 中所有样本数据的十进制对数。特殊情况同上。</p>
<h3 id="minute"><strong><code>minute()</code></strong></h3>
<p><code>minute(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前小时的第多少分钟。结果范围：0~59。</p>
<h3 id="month"><strong><code>month()</code></strong></h3>
<p><code>month(v=vector(time()) instant-vector)</code> 函数返回给定 UTC 时间当前属于第几个月，结果范围：<code>0~12</code>。</p>
<h3 id="predict_linear"><strong><code>predict_linear()</code></strong></h3>
<p><code>predict_linear(v range-vector, t scalar)</code> 函数可以预测时间序列 <code>v</code> 在 <code>t</code> 秒后的值。</p>
<p>它基于简单线性回归的方式，对时间窗口内的样本数据进行统计，从而可以对时间序列的变化趋势做出预测。该函数的返回结果不带有度量指标，只有标签列表。</p>
<p>例如，基于 <code>2</code> 小时的样本数据，来预测主机可用磁盘空间的是否在 4 个小时候被占满，可以使用如下表达式：</p>
<pre><code>predict_linear(http_requests_total{code=&quot;200&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}[5m], 5)
结果：
{code=&quot;200&quot;,handler=&quot;query_range&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}  1
{code=&quot;200&quot;,handler=&quot;prometheus&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}   4283.449995397104
{code=&quot;200&quot;,handler=&quot;static&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}   22.99999999999999
...
</code></pre>
<p>这个函数一般只用在 Gauge 类型的时间序列上。</p>
<h3 id="rate"><strong><code>rate()</code></strong></h3>
<p><code>rate(v range-vector)</code> 函数可以直接计算区间向量 v 在时间窗口内平均增长速率，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。该函数的返回结果不带有度量指标，只有标签列表。</p>
<p>例如，<strong>以下表达式返回区间向量中每个时间序列过去 5 分钟内 HTTP 请求数的每秒增长率</strong>：</p>
<pre><code>rate(http_requests_total[5m])
结果：
{code=&quot;200&quot;,handler=&quot;label_values&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;} 0
{code=&quot;200&quot;,handler=&quot;query_range&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}  0
{code=&quot;200&quot;,handler=&quot;prometheus&quot;,instance=&quot;120.77.65.193:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;}   0.2
...
</code></pre>
<p><strong>rate() 函数返回值类型只能用计数器，在长期趋势分析或者告警中推荐使用这个函数</strong>。</p>
<h3 id="resets"><strong><code>resets()</code></strong></h3>
<p><code>resets(v range-vector)</code> 的参数是一个区间向量。对于每个时间序列，它都返回一个计数器重置的次数。两个连续样本之间的值的减少被认为是一次计数器重置。</p>
<p>这个函数一般只用在计数器类型的时间序列上。</p>
<h3 id="round"><strong><code>round()</code></strong></h3>
<p><code>round(v instant-vector, to_nearest=1 scalar)</code> 函数与 <code>ceil</code>和 <code>floor</code> 函数类似，返回向量中所有样本值的最接近的整数。<code>to_nearest</code> 参数是可选的,默认为 <code>1</code>,表示样本返回的是最接近 <code>1</code> 的整数倍的值。你也可以将该参数指定为任意值（也可以是小数），表示样本返回的是最接近它的整数倍的值。</p>
<h3 id="scalar"><strong><code>scalar()</code></strong></h3>
<p><code>scalar(v instant-vector)</code> 函数的参数是一个单元素的瞬时向量,它返回其唯一的时间序列的值作为一个标量。如果度量指标的样本数量大于 <code>1</code>或者等于 <code>0</code>, 则返回 <code>NaN</code>。</p>
<h3 id="sort"><strong><code>sort()</code></strong></h3>
<p><code>sort(v instant-vector)</code>函数对向量按元素的值进行升序排序，返回结果：<code>key: value = 度量指标：样本值[升序排列]</code>。</p>
<h3 id="sort_desc"><strong><code>sort_desc()</code></strong></h3>
<p><code>sort(v instant-vector)</code> 函数对向量按元素的值进行降序排序，返回结果：<code>key: value = 度量指标：样本值[降序排列]</code>。</p>
<h3 id="sqrt"><strong><code>sqrt()</code></strong></h3>
<p><code>sqrt(v instant-vector)</code> 函数计算向量 v 中所有元素的平方根。</p>
<h3 id="time"><strong><code>time()</code></strong></h3>
<p><code>time()</code> 函数返回从 1970-01-01 到现在的秒数。注意：它不是直接返回当前时间，而是时间戳</p>
<h3 id="timestamp"><strong><code>timestamp()</code></strong></h3>
<p><code>timestamp(v instant-vector)</code>函数返回向量 v 中的每个样本的时间戳（从 1970-01-01 到现在的秒数）。</p>
<h3 id="vector"><strong><code>vector()</code></strong></h3>
<p><code>vector(s scalar)</code> 函数将标量 s 作为没有标签的向量返回，即返回结果为：<code>key: value= {}, s</code>。</p>
<h3 id="year"><strong><code>year()</code></strong></h3>
<p><code>year(v=vector(time()) instant-vector)</code> 函数返回被给定 UTC 时间的当前年份。</p>
<h3 id="aggregation_over_time"><strong><code>&lt;aggregation&gt;_over_time()</code></strong></h3>
<p><strong>下面的函数列表允许传入一个区间向量，它们会聚合每个时间序列的范围，并返回一个瞬时向量</strong>：</p>
<ul>
<li><code>avg_over_time(range-vector)</code> : 区间向量内每个度量指标的平均值。</li>
<li><code>min_over_time(range-vector)</code> : 区间向量内每个度量指标的最小值。</li>
<li><code>max_over_time(range-vector)</code> : 区间向量内每个度量指标的最大值。</li>
<li><code>sum_over_time(range-vector)</code> : 区间向量内每个度量指标的求和。</li>
<li><code>count_over_time(range-vector)</code> : 区间向量内每个度量指标的样本数据个数。</li>
<li><code>quantile_over_time(scalar, range-vector)</code> : 区间向量内每个度量指标的样本数据值分位数，<code>φ-quantile (0 ≤ φ ≤ 1)</code>。</li>
<li><code>stddev_over_time(range-vector)</code> : 区间向量内每个度量指标的总体标准差。</li>
<li><code>stdvar_over_time(range-vector)</code>: 区间向量内每个度量指标的总体标准方差</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
      
        
        <a href="../2Promql_basic2/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 2 PromQL 操作符 &amp; 内置函数" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              2 PromQL 操作符 & 内置函数
            </div>
          </div>
        </a>
      
      
        
        <a href="../4Promql_basic4/" class="md-footer__link md-footer__link--next" aria-label="下一页: 4 PromQL简单示例" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              4 PromQL简单示例
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021-9999 Jacob Xi
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.39f04ddb.min.js"></script>
      
    
  </body>
</html>